<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Practice Questions Viewer</title>

  <style>
    :root { color-scheme: light; }
    body{
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      max-width: 980px;
      margin: 28px auto;
      padding: 0 14px 60px;
      line-height: 1.5;
      color: #222;
      background: #fafafa;
    }
    header{
      background:#fff;
      border-radius:14px;
      padding:18px 18px 14px;
      box-shadow:0 6px 18px rgba(0,0,0,0.08);
      margin-bottom:18px;
    }
    h1{ margin:0 0 6px; font-size:1.55rem; }
    .muted{ color:#555; margin:0; }
    .error{
      margin-top:12px;
      padding:10px 12px;
      border-radius:12px;
      background:#fff2f2;
      border:1px solid #ffd2d2;
      color:#8a1f1f;
      display:none;
      white-space: pre-wrap;
    }
    .controls{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      margin-top:12px;
      align-items:center;
    }
    button{
      border:1px solid #ddd;
      background:#fff;
      padding:10px 12px;
      border-radius:12px;
      font-weight:650;
      cursor:pointer;
    }
    button:hover{ background:#f3f3f3; }
    .pill{
      display:inline-block;
      padding:6px 10px;
      border-radius:999px;
      background:#f1f1f1;
      color:#444;
      font-size:0.9rem;
    }
    ol{ padding-left:1.35em; margin:0; }
    li{
      background:#fff;
      margin:12px 0;
      padding:14px 14px 12px;
      border-radius:14px;
      box-shadow:0 4px 14px rgba(0,0,0,0.06);
    }
    .qhead{
      display:flex;
      flex-direction:column;
      gap:8px;
      margin-bottom:10px;
    }
    .concept{ font-size:0.95rem; color:#555; }
    .row{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }
    .toggle{
      border:1px solid #d8d8d8;
      background:#fff;
      padding:8px 10px;
      border-radius:12px;
      font-weight:700;
    }
    .toggle[data-open="true"]{ background:#eaf3ff; border-color:#c7ddff; }
    .answer{
      display:none;
      margin-top:10px;
      padding:10px 12px;
      border-radius:12px;
      background:#f6f8fa;
      border:1px solid #e7e7e7;
      white-space: pre-wrap;
    }
    footer{
      margin-top:22px;
      color:#666;
      font-size:0.9rem;
      text-align:center;
    }
    code{
      background:#f3f3f3;
      padding:2px 6px;
      border-radius:8px;
    }
  </style>

  <!-- Optional MathJax support (for LaTeX in questions/answers). Safe if no LaTeX present. -->
  <script>
    window.MathJax = { tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] } };
  </script>
  <script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>

<body>
  <header>
    <h1 id="title">Practice Questions Viewer</h1>
    <p class="muted" id="subtitle">Load a JSON problem set via a URL parameter.</p>

    <div class="controls">
      <span class="pill" id="filePill">file: (none)</span>
      <button type="button" onclick="expandAll()">Show all answers</button>
      <button type="button" onclick="collapseAll()">Hide all answers</button>
      <button type="button" onclick="toggleAll()">Toggle all</button>
    </div>

    <div class="error" id="err"></div>

    <p class="muted" style="margin-top:12px;">
      Usage: open this page like <code>viewer.html?file=algebra2_100.json</code>
    </p>
    <p class="muted" style="margin-top:6px;">
      Note: some browsers block loading JSON via <code>file://</code>. If you see an error, run a local server
      (examples at the bottom of this page).
    </p>
  </header>

  <ol id="questions"></ol>

  <footer>
    <div>Local server quick starts:</div>
    <div><code>python -m http.server 8000</code> then open <code>http://localhost:8000/viewer.html?file=YOUR.json</code></div>
    <div style="margin-top:6px;"><code>npx serve</code> also works if you have Node installed.</div>
  </footer>

<script>
  function getParam(name) {
    const params = new URLSearchParams(window.location.search);
    return params.get(name);
  }

  function showError(msg) {
    const el = document.getElementById('err');
    el.style.display = 'block';
    el.textContent = msg;
  }

  function clearError() {
    const el = document.getElementById('err');
    el.style.display = 'none';
    el.textContent = '';
  }

  function escapeHtml(s) {
    return String(s)
      .replaceAll('&', '&amp;')
      .replaceAll('<', '&lt;')
      .replaceAll('>', '&gt;')
      .replaceAll('"', '&quot;')
      .replaceAll("'", '&#039;');
  }

  function render(data) {
    const title = data?.title ? String(data.title) : 'Practice Questions';
    const version = data?.version ? `v${data.version}` : '';
    const notes = data?.notes ? String(data.notes) : '';
    const questions = Array.isArray(data?.questions) ? data.questions : [];

    document.getElementById('title').textContent = title;
    document.getElementById('subtitle').textContent = [version, notes].filter(Boolean).join(' • ') || 'Click “Show answer” to toggle solutions.';
    const list = document.getElementById('questions');
    list.innerHTML = '';

    questions.forEach((q, idx) => {
      const id = (q && (q.id ?? (idx + 1))) ?? (idx + 1);
      const qType = q?.question_type ?? 'unknown';
      const qText = q?.question ?? '';
      const aText = q?.answer ?? '';

      const li = document.createElement('li');
      li.innerHTML = `
        <div class="qhead">
          <div><strong>${escapeHtml(id)}.</strong> ${escapeHtml(qText)}</div>
          <div class="concept">(Concept: ${escapeHtml(qType)})</div>
        </div>
        <div class="row">
          <button class="toggle" type="button" data-open="false" onclick="toggleAnswer('${escapeHtml(id)}')">Show answer</button>
        </div>
        <div class="answer" id="a${escapeHtml(id)}">${escapeHtml(aText)}</div>
      `;
      list.appendChild(li);
    });

    // If MathJax is loaded, typeset the newly-inserted content
    if (window.MathJax && window.MathJax.typesetPromise) {
      window.MathJax.typesetPromise().catch(() => {});
    }
  }

  function toggleAnswer(id) {
    const ans = document.getElementById('a' + id);
    if (!ans) return;

    const btn = ans.parentElement.querySelector('button.toggle');
    const isOpen = ans.style.display === 'block';

    ans.style.display = isOpen ? 'none' : 'block';
    btn.textContent = isOpen ? 'Show answer' : 'Hide answer';
    btn.dataset.open = isOpen ? 'false' : 'true';

    if (!isOpen && window.MathJax && window.MathJax.typesetPromise) {
      window.MathJax.typesetPromise([ans]).catch(() => {});
    }
  }

  function expandAll() {
    document.querySelectorAll('.answer').forEach(a => a.style.display = 'block');
    document.querySelectorAll('button.toggle').forEach(b => { b.textContent = 'Hide answer'; b.dataset.open = 'true'; });
    if (window.MathJax && window.MathJax.typesetPromise) {
      window.MathJax.typesetPromise().catch(() => {});
    }
  }

  function collapseAll() {
    document.querySelectorAll('.answer').forEach(a => a.style.display = 'none');
    document.querySelectorAll('button.toggle').forEach(b => { b.textContent = 'Show answer'; b.dataset.open = 'false'; });
  }

  function toggleAll() {
    const answers = Array.from(document.querySelectorAll('.answer'));
    const anyHidden = answers.some(a => a.style.display !== 'block');
    if (anyHidden) expandAll();
    else collapseAll();
  }

  async function load() {
    clearError();

    const file = getParam('file') || getParam('json') || getParam('set');
    const pill = document.getElementById('filePill');
    pill.textContent = 'file: ' + (file || '(none)');

    if (!file) {
      showError(
        "Missing parameter.\n\n" +
        "Add a query string like:\n" +
        "  viewer.html?file=algebra2_100.json\n\n" +
        "Your JSON must match the format:\n" +
        "{ title, version, notes, questions: [ { id, question_type, question, answer }, ... ] }"
      );
      return;
    }

    try {
      // Fetch the JSON (must be served over http(s) in many browsers).
      const res = await fetch(file, { cache: "no-store" });
      if (!res.ok) throw new Error(`HTTP ${res.status} when fetching "${file}"`);
      const data = await res.json();
      render(data);
    } catch (e) {
      showError(
        "Could not load the JSON file.\n\n" +
        "Common causes:\n" +
        "1) Browser blocked file:// fetch. Use a local server.\n" +
        "2) Wrong path/name. Verify the JSON file is next to this page or adjust the file path.\n" +
        "3) JSON parse error.\n\n" +
        "Details:\n" + (e && e.message ? e.message : String(e))
      );
    }
  }

  // Expose functions for inline onclick handlers
  window.toggleAnswer = toggleAnswer;
  window.expandAll = expandAll;
  window.collapseAll = collapseAll;
  window.toggleAll = toggleAll;

  load();
</script>
</body>
</html>